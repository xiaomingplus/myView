{"version":3,"sources":["common/module.js"],"names":["JSON","f","n","quote","string","escapable","lastIndex","test","replace","a","c","meta","charCodeAt","toString","slice","str","key","holder","i","k","v","length","partial","mind","gap","value","toJSON","rep","call","isFinite","String","indent","Object","prototype","apply","join","push","hasOwnProperty","Date","this","valueOf","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","Number","Boolean","cx","\b","\t","\n","\f","\r","\"","\\","stringify","replacer","space","Error","","parse","text","reviver","walk","undefined","j","eval","SyntaxError","modulejs","require","define","global","_loadCache","_useCache","localStorage","removeItem","store","getItem","substr","now","getTime","oneDay","cfg","alias","_getModuleURI","path","deps","indexOf","emit","cacheTime","setItem","e","cacheLoad","id","moduleURI","factory","isCache","window","debug","agent","navigator","userAgent","toLowerCase","m","match","parseInt","_cacheModule","_t","ms","_url","_moduleConfig","domain","_ms","split","_mindex","_muri","_urls","l","_id","splice","uris","_define","modules","arguments","isType","_deps","parseDependencies","mergeArray","mod","Module","dependencies","parseVars","callback","MODULE_SUCCESS","_require","module","exports","timing","_modulejs","checkDeps","getDesps","list","flag","loadModule","VARS_RE","vars","mergeObject","b","config","obj","uri","url","loadMod","MODULE_LOADING","head","document","getElementsByTagName","documentElement","baseElement","node","createElement","charset","async","src","handler","callee","time","onload","beforeLoad","insertBefore","appendChild","loadModuleDep","len","dep","moduleDeps","item","len1","moduleToLoad","cmbUrl","cmbAr","id1","on","name","cb","cbs","events","evt","cleanArray","type","code","commentRegExp","cjsRequireRegExp","ret","version","location","href","cssAlias","actModules","cacheDel","fromeCache","init","mods","allDeps","console","error","cacheNow","css","setAttribute","Math","random"],"mappings":"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","file":"common/module.js","sourcesContent":["/**\n * JSON支持\n * @param  {[type]} ){function f(n){return  n<10?\"0\"+n:n;}if(typeof Date.prototype.toJSON!==\"function\"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+\"-\"+f(this.getUTCMonth()+1)+\"-\"+f(this.getUTCDate())+\"T\"+f(this.getUTCHours())+\":\"+f(this.getUTCMinutes())+\":\"+f(this.getUTCSeconds() [description]\n * @return {[type]}             [description]\n */\nif (typeof JSON !== \"object\") {\n    JSON = {};\n}(function() {\n    function f(n) {\n        return n < 10 ? \"0\" + n : n;\n    }\n    if (typeof Date.prototype.toJSON !== \"function\") {\n        Date.prototype.toJSON = function(key) {\n            return isFinite(this.valueOf()) ? this.getUTCFullYear() + \"-\" + f(this.getUTCMonth() + 1) + \"-\" + f(this.getUTCDate()) + \"T\" + f(this.getUTCHours()) + \":\" + f(this.getUTCMinutes()) + \":\" + f(this.getUTCSeconds()) + \"Z\" : null;\n        };\n        String.prototype.toJSON = Number.prototype.toJSON = Boolean.prototype.toJSON = function(key) {\n            return this.valueOf();\n        };\n    }\n    var cx = /[\\u0000\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g,\n        escapable = /[\\\\\\\"\\x00-\\x1f\\x7f-\\x9f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g,\n        gap, indent, meta = {\n            \"\\b\": \"\\\\b\",\n            \"\\t\": \"\\\\t\",\n            \"\\n\": \"\\\\n\",\n            \"\\f\": \"\\\\f\",\n            \"\\r\": \"\\\\r\",\n            '\"': '\\\\\"',\n            \"\\\\\": \"\\\\\\\\\"\n        },\n        rep;\n\n    function quote(string) {\n        escapable.lastIndex = 0;\n        return escapable.test(string) ? '\"' + string.replace(escapable, function(a) {\n            var c = meta[a];\n            return typeof c === \"string\" ? c : \"\\\\u\" + (\"0000\" + a.charCodeAt(0).toString(16)).slice(-4);\n        }) + '\"' : '\"' + string + '\"';\n    }\n\n    function str(key, holder) {\n        var i, k, v, length, mind = gap,\n            partial, value = holder[key];\n        if (value && typeof value === \"object\" && typeof value.toJSON === \"function\") {\n            value = value.toJSON(key);\n        }\n        if (typeof rep === \"function\") {\n            value = rep.call(holder, key, value);\n        }\n        switch (typeof value) {\n            case \"string\":\n                return quote(value);\n            case \"number\":\n                return isFinite(value) ? String(value) : \"null\";\n            case \"boolean\":\n            case \"null\":\n                return String(value);\n            case \"object\":\n                if (!value) {\n                    return \"null\";\n                }\n                gap += indent;\n                partial = [];\n                if (Object.prototype.toString.apply(value) === \"[object Array]\") {\n                    length = value.length;\n                    for (i = 0; i < length; i += 1) {\n                        partial[i] = str(i, value) || \"null\";\n                    }\n                    v = partial.length === 0 ? \"[]\" : gap ? \"[\\n\" + gap + partial.join(\",\\n\" + gap) + \"\\n\" + mind + \"]\" : \"[\" + partial.join(\",\") + \"]\";\n                    gap = mind;\n                    return v;\n                }\n                if (rep && typeof rep === \"object\") {\n                    length = rep.length;\n                    for (i = 0; i < length; i += 1) {\n                        if (typeof rep[i] === \"string\") {\n                            k = rep[i];\n                            v = str(k, value);\n                            if (v) {\n                                partial.push(quote(k) + (gap ? \": \" : \":\") + v);\n                            }\n                        }\n                    }\n                } else {\n                    for (k in value) {\n                        if (Object.prototype.hasOwnProperty.call(value, k)) {\n                            v = str(k, value);\n                            if (v) {\n                                partial.push(quote(k) + (gap ? \": \" : \":\") + v);\n                            }\n                        }\n                    }\n                }\n                v = partial.length === 0 ? \"{}\" : gap ? \"{\\n\" + gap + partial.join(\",\\n\" + gap) + \"\\n\" + mind + \"}\" : \"{\" + partial.join(\",\") + \"}\";\n                gap = mind;\n                return v;\n        }\n    }\n    if (typeof JSON.stringify !== \"function\") {\n        JSON.stringify = function(value, replacer, space) {\n            var i;\n            gap = \"\";\n            indent = \"\";\n            if (typeof space === \"number\") {\n                for (i = 0; i < space; i += 1) {\n                    indent += \" \";\n                }\n            } else {\n                if (typeof space === \"string\") {\n                    indent = space;\n                }\n            }\n            rep = replacer;\n            if (replacer && typeof replacer !== \"function\" && (typeof replacer !== \"object\" || typeof replacer.length !== \"number\")) {\n                throw new Error(\"JSON.stringify\");\n            }\n            return str(\"\", {\n                \"\": value\n            });\n        };\n    }\n    if (typeof JSON.parse !== \"function\") {\n        JSON.parse = function(text, reviver) {\n            var j;\n\n            function walk(holder, key) {\n                var k, v, value = holder[key];\n                if (value && typeof value === \"object\") {\n                    for (k in value) {\n                        if (Object.prototype.hasOwnProperty.call(value, k)) {\n                            v = walk(value, k);\n                            if (v !== undefined) {\n                                value[k] = v;\n                            } else {\n                                delete value[k];\n                            }\n                        }\n                    }\n                }\n                return reviver.call(holder, key, value);\n            }\n            text = String(text);\n            cx.lastIndex = 0;\n            if (cx.test(text)) {\n                text = text.replace(cx, function(a) {\n                    return \"\\\\u\" + (\"0000\" + a.charCodeAt(0).toString(16)).slice(-4);\n                });\n            }\n            if (/^[\\],:{}\\s]*$/.test(text.replace(/\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g, \"@\").replace(/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g, \"]\").replace(/(?:^|:|,)(?:\\s*\\[)+/g, \"\"))) {\n                j = eval(\"(\" + text + \")\");\n                return typeof reviver === \"function\" ? walk({\n                    \"\": j\n                }, \"\") : j;\n            }\n            throw new SyntaxError(\"JSON.parse\");\n        };\n    }\n}());\n/**\n * modulejs 1.0.2\n * author:kpxu\\jimyan\\wowowang\n * description:\n *   modulejs是一款比seajs、commonjs更加简洁、小巧的javascript模块化开发管理工具。\n *   思路精巧优雅，包含注释在内只有222行，同时也吸收了seajs和requirejs的一些优点\n * see：https://github.com/eccued/modulejs\n * update----brianliu 20130924\n *           更新require.css支持alias\n */\nvar modulejs, require, define;\n(function(global) {\n    var mod, cfg, _modulejs, _define, _require;\n    var version = \"1.0.2\";\n    var isCache = true;\n    var MODULE_LOADING = 1,\n        MODULE_SUCCESS = 2; //模块加载的状态，  loading是发起loadScript， success是define成功\n    var cacheTime = 60 * 60 * 24 * 30 * 1000; //一个月\n    cfg = {\n        debug: location.href.indexOf(\"mdebug=1\") != -1 ? true : false, //调试模式。\n        alias: {}, //模块的所在文件路径定义\n        cssAlias: {}, //css文件别名\n        moduleURI: {}, //模块的单独访问uri\n        vars: {}, //变量模块名\n        uris: {}, //加载文件列表 文件URL作为下标，true为已加载  false为未加载\n        loadMod: {}, //正在加载的模块id，如果某个模块正在加载，那么不做加载处理\n        modules: {}, //模块列表 模块id作为下标\n        callback: [], //入口回调方法的数组,所有modulejs所定义的方法都压入这个数组\n        actModules: {}, //被require激活使用的module列表\n        cacheLoad: {}, //被加载的cache 模块列表\n        cacheDel: {}, //被删除的module cache\n        deps: {}, //记录运行中需要用到的依赖队列\n\n        //记录加载某个模块时，需要同时并发加载的其他模块名\n        //举例 {'moduleA': ['moduleB', 'moduleC']}\n        //这样加载 moduleA 的同时，会并发地加载 moduleB 和 moduleC\n        moduleDeps: {},\n        events: {}, //消息队列\n        timing: {} //所有与性能有关的数据\n    };\n    //读取预配置\n    _modulejs.config = config;\n    config(global[\"_moduleConfig\"] ? global._moduleConfig : cfg);\n    global[\"_moduleConfig\"] = cfg;\n    //输出api\n    require = _require; //引用\n    define = _define; //定义\n    modulejs = _modulejs; //入口\n    //监听模块准备就绪的事件,并检查需要回调module的相关依赖是否全部就绪\n    on(\"module_ready\", function(id, fromeCache) {\n        cfg.callback = cleanArray(cfg.callback);\n        var init = cfg.callback,\n            l = init.length;\n        //顺序扫描所有的回调方法，检查要回调的module是否完成依赖加载\n        for (var i = 0; i < l; i++) {\n            //如果依赖满足则开始执行并删除回调\n            if (init[i] && checkDeps(init[i].dependencies)) {\n                var cb = init[i].factory;\n                var deps = init[i].dependencies;\n                var mods = []; //把模块的相关依赖，依次作为参数传入\n                var allDeps = [];\n                var m;\n                for (var j = 0; j < deps.length; j++) {\n                    var m = _require(deps[j]);\n                    allDeps.push(m.dependencies);\n                    mods.push(m);\n                }\n                debug(\"callback_is_run=start\", cb.toString(), cfg.callback);\n                init[i] = null;\n                cb.apply(null, mods);\n                cfg.debug && emit(\"callback_is_run\", cb.toString().replace(/[\\r\\n]/g, \"\"));\n            }\n        }\n    });\n    //module被引用\n    on(\"module_require\", function(id) {\n        cfg.actModules[id] = cfg.actModules[id] ? (cfg.actModules[id] + 1) : 1;\n    });\n    //cache被删除\n    on(\"module_cacheDel\", function(id) {\n        cfg.cacheDel[id] = 1;\n    });\n    //cache被加载\n    on(\"cache_load\", function(m) {\n\n    });\n    //module未定义\n    on(\"module_loss_alias\", function(id) {\n        console.error(\"module_loss_alias:\" + id);\n    });\n\n\n    //加载缓存的模块\n    var cacheNow = new Date();\n    _loadCache();\n    cfg.timing['loadcache'] = new Date() - cacheNow;\n    /**\n     * 加载缓存的modules\n     * @return {[type]} [description]\n     */\n\n    function _loadCache() {\n        if (!_useCache()) {\n            return false;\n        }\n        localStorage.removeItem(\"_modules\"); //删除之前的cache\n        //读cache，并清理无效内容\n        //var _t=localStorage.getItem(\"_modules\");\n        //var ms=_t?JSON.parse(_t):{};\n        for (var key in localStorage) {\n            if (/^_m_/.test(key)) {\n                var store = JSON.parse(localStorage.getItem(key));\n                var i = key.substr(3);\n                var now = (new Date()).getTime();\n                var oneDay = 24 * 3600 * 1000;\n                if (cfg.alias[i]) {\n                    if (_getModuleURI(i) != store.path || store.deps.join(\",\").indexOf(\"{\") > -1) {\n                        emit(\"module_cacheDel\", i);\n                        localStorage.removeItem(key);\n                        continue;\n                    }\n                } else {\n                    //已经过期\n                    if (now > store.cacheTime) {\n                        emit(\"module_cacheDel\", i);\n                        localStorage.removeItem(key);\n                        continue;\n                    }\n                }\n\n                //有效期小于1天,缓存续期\n                if (store.cacheTime - now < oneDay) {\n                    store.cacheTime = (new Date()).getTime() + cacheTime; //更新过期时间，每次续期一个月\n                    try {\n                        localStorage.removeItem(key);\n                        localStorage.setItem(key, JSON.stringify(store));\n                    } catch (e) {}\n                }\n                //eval(\"store.factory = \" + store.factory)\n                cfg.cacheLoad[store.id] = store;\n                emit(\"cache_load\", store);\n                /**ADD END**/\n\n            }\n        }\n        /**\n         * 这里对cache的检查有两个原则：\n         * 1、path路径发生变化的cache一律作为，未来可能会考虑版本号的问题。这里不考虑\n         * 2、本入口alisa中未定义的module可能会在其他入口中用到，不能随便清除，所以加一个有效期逻辑，超过有效期的cache做删除动作，防止localstorage无线增长。\n         */\n        /*\n        for(var i in ms){\n          //检查alisa中定义的module，path变化的要清理，无变化的修改最后使用时间并加载\n          if(cfg.alias[i]){\n            if(_getModuleURI(i)!=ms[i].path){\n              emit(\"module_cacheDel\",i);\n              ms[i]=null; delete(ms[i]);\n              continue;\n            }\n          }else{\n            //alisa中未定义的module，检查最后使用时间，超过1个月未使用的module清理掉\n            if(((new Date()).getTime()-60*60*24*30)>ms[i].cacheTime){\n              emit(\"module_cacheDel\",i);\n              ms[i]=null; delete(ms[i]);\n              continue;\n            }\n          }\n          //走到这里说明cache有效也是alisa中要用到的module，可以直接加载，打标记，停止cache期间的define再次触发cache\n          //重载过的module cache修改使用时间\n          ms[i].cacheTime=(new Date()).getTime();\n          isCache=false;\n          emit(\"cache_load\",ms[i]);\n          _define(ms[i].id,ms[i].deps,eval(\"(\"+ms[i].factory+\")\"));\n          isCache=true;\n        }\n        //cache加载结束再回写一下cache\n        try{\n          localStorage.removeItem(\"_modules\");\n          localStorage.setItem(\"_modules\", JSON.stringify(ms));\n        }\n        catch(e){\n\n        }*/\n    }\n    /**\n     * 获取模块的唯一访问路径\n     * @param  {[type]} id [description]\n     * @return {[type]}    [description]\n     */\n\n    function _getModuleURI(id) {\n        return cfg.moduleURI[id] ? cfg.moduleURI[id] : cfg.alias[id];\n    }\n    /**\n     * 使用模块缓存\n     */\n\n    function _useCache(id, deps, factory) {\n        //return false;\n        //不支持JSON对象的时候不启用cache\n        if (typeof(JSON) == \"undefined\") {\n            return false;\n        }\n        //cache开关关闭的的时候不使用cache\n        if (!isCache) {\n            return false;\n        }\n        //不支持JSON和localstorage则不做cache\n        if (!(JSON && window.localStorage)) {\n            return false;\n        }\n        //开发模式下不使用缓存\n        if (cfg.debug) {\n            return false;\n        }\n\n        var agent = navigator.userAgent.toLowerCase();\n        if (agent.indexOf(\"msie\") > 0) {\n            var m = agent.match(/msie\\s([\\d\\.]+);/i);\n            if (m && m.length >= 2 && parseInt(m[1]) <= 6) {\n                return false;\n            }\n        }\n\n        //_下划线开头的module为临时module，不操作cache\n        if (id && id.indexOf(\"_\") == 0) {\n            return false;\n        }\n        //factory代码中不包含关键词“_cacheThisModule_”的不缓存\n        if (factory && factory.toString().indexOf(\"_cacheThisModule_\") < 0) {\n            return false;\n        }\n        return true;\n    }\n\n\n    /**\n     * 缓存模块\n     * @param  {[type]} id      [description]\n     * @param  {[type]} deps    [description]\n     * @param  {[type]} factory [description]\n     * @return {[type]}         [description]\n     */\n\n    function _cacheModule(id, deps, factory) {\n        //写入cache\n        var key = \"_m_\" + id;\n        var _t = localStorage.getItem(key);\n        var ms = _t ? JSON.parse(_t) : {};\n        ms = {\n            \"id\": id,\n            \"deps\": deps,\n            \"factory\": factory.toString(),\n            \"path\": _getModuleURI(id),\n            \"cacheTime\": (new Date()).getTime() + cacheTime\n        };\n        try {\n            localStorage.removeItem(key);\n            localStorage.setItem(key, JSON.stringify(ms));\n            emit(\"module_cached\", id);\n        } catch (e) {}\n\n        /**\n         * 把定义的模块从他同个分组之内的其他模块的加载地址中剔除。\n         * 如cache模块和url device模块属于同个分组。那么他们的地址都是http://static.gtimg.com/c/=/js/cache.js,/js/url.js,/js/device.js\n         * 那么当cache模块定义之后，url device模块对应的地址是：http://static.gtimg.com/c/=/js/url.js,/js/device.js\n         * 这个优化只正对TX的legos平台生成的入口文件做的。\n         */\n        var _url = _moduleConfig.alias[id];\n        //如果是单个分组，那么就不做任何处理。\n        if (_url.indexOf(\"/c/=\") == -1) {\n            return true;\n        }\n        //如果没有设置domain，那么也直接返回\n        if (_moduleConfig.domain == undefined) {\n            return true;\n        }\n        //从URL中分析出所有的模块列表。\n        var _ms = _url.replace(_moduleConfig.domain + \"/c/=\", \"\")\n            .replace(/\\/js\\/version\\/[\\d]+\\//g, \"\")\n            .replace(/\\.\\d{12}\\.js/g, \"\")\n            .split(\",\"),\n            _mindex = -1,\n            _muri = \"\",\n            _urls = _url.replace(_moduleConfig.domain + \"/c/=\", \"\").split(\",\"); //模块URLS\n\n        for (var i = 0, l = _ms.length; i < l; i++) {\n            //从URL中分析出对应的模块id.\n            var _id = _ms[i];\n            //如果当前的_id，记录当前的在分组中的index\n            if (_id == id) {\n                _mindex = i;\n                break;\n            }\n        }\n\n        //删除当前模块的URI。\n        if (_mindex > -1) {\n            _muri = _urls.splice(_mindex, 1);\n            _moduleConfig.alias[_id] = _moduleConfig.domain + _muri;\n        }\n        //把当前模块从同组内其他模块的加载地址中删除\n        for (var i = 0, l = _urls.length; i < l; i++) {\n            //从URL中分析出对应的模块id.\n            var _id = _urls[i].replace(/\\/js\\/version\\/[\\d]+\\//g, \"\")\n                .replace(/\\.\\d{12}\\.js/g, \"\");\n            //把所有模块的URL删除当前的模块。\n            _moduleConfig.alias[_id] = _moduleConfig.domain + (_urls.length > 1 ? \"/c/=\" : \"\") + _urls.join(\",\");\n            //如果_url已经加载 那么直接跳过加载，一般这种情况是多个模块合并同时加载回来，那么就默认为加载完成\n            if (cfg.uris[_url]) {\n                cfg.uris[_moduleConfig.alias[_id]] = 1;\n            }\n        }\n    }\n    //模块定义api，有三个参数的时候第2个参数为依赖array，2个参数时，第2个为回调\n\n    function _define(id, deps, factory) {\n        if (!id || (typeof(id) != \"string\"))\n            return;\n        //如果模块已经存在，并且不是_init模块，那么直接提示模块已经就绪\n        if (id != \"_init\" && typeof(cfg.modules[id]) != \"undefined\") {\n            emit(\"module_ready\", id);\n            return true;\n        }\n        //只有两个参数的时候，表示忽略了deps\n        if (arguments.length === 2) {\n            factory = deps;\n            deps = null;\n        }\n        //保证deps一定是个array\n        deps = isType(\"Array\", deps) ? deps : (deps ? [deps] : []);\n        //静态分析内容中的依赖\n        if (isType(\"Function\", factory)) {\n            var _deps = parseDependencies(factory.toString());\n        }\n        _useCache(id, deps, factory) && _cacheModule(id, deps, factory);\n        //合并明文依赖和分析依赖\n        deps = mergeArray(deps, _deps);\n        //将模块cache起来\n        //构造一个model压入mod仓库\n        var mod = new Module(id);\n        mod.dependencies = deps || [];\n        for (var i = mod.dependencies.length - 1; i >= 0; i--) {\n            mod.dependencies[i] = parseVars(mod.dependencies[i]);\n        }\n        mod.factory = factory;\n        //如果是_init的话，则放入回调模块数组，否则放入module序列\n        if (id == \"_init\") {\n            cfg.callback.push(mod);\n        } else {\n            //非_init则为普通模块，放入module序列\n            cfg.modules[id] = mod;\n        }\n        if (typeof cfg.alias[id] !== \"undefined\") {\n            //1. 如果define的模块名和alias中定义的模块名不一致，是走不进来的\n            //2. 如果文件发布失败，比如发到beta环境下，js文件为空的情况，不会执行define，也是走不进来的\n            cfg.uris[cfg.alias[id]] = MODULE_SUCCESS;\n        }\n        //广播消息处理\n        emit(\"module_ready\", id);\n    }\n    //模块实例化或返回实例\n\n    function _require(id) {\n        id = parseVars(id); //解析变量依赖\n        var module = cfg.modules[id];\n\n        emit(\"module_require\", id);\n        // 如果module不存在则返回null\n        if (!module) {\n            emit(\"module_error\", id);\n            return null\n        }\n        //如果module的exports不为null，则说明已经实例化了。\n        if (module.exports) {\n            return module.exports;\n        }\n        var now = new Date();\n        //走到这里则说明module还没有被实例化\n        var factory = module.factory;\n        //判断factory类型，function则执行，obj的直接返回\n        //为function的时候将被直接执行，执行时将会接收到3个参数factory(require,exports,module)\n        var exports = isType(\"Function\", factory) ? factory(require, module.exports = {}, module) : factory;\n        module.exports = exports === undefined ? module.exports : exports;\n        cfg.timing[id] = new Date() - now;\n        return module.exports; //require一个模块的结果是返回该module的exports\n    }\n\n    _require.async = _modulejs;\n\n    _require.css = function(path) {\n            /*\n            var node = document.createElement(\"link\");\n            node.charset = \"utf-8\";\n            node.rel = \"stylesheet\"\n            node.href = url\n\n            var head = document.getElementsByTagName(\"head\")[0] || document.documentElement;\n            var baseElement = head.getElementsByTagName(\"base\")[0];\n            baseElement ? head.insertBefore(node, baseElement) : head.appendChild(node);\n            */\n            //update----brianliu 20130924 支持cssalias\n            path = cfg.cssAlias && cfg.cssAlias[path] ? cfg.cssAlias[path] : path;\n            if (!path) {\n                return;\n            }\n            var l;\n            if (!window[\"_loadCss\"] || window[\"_loadCss\"].indexOf(path) < 0) {\n                l = document.createElement('link');\n                l.setAttribute('type', 'text/css');\n                l.setAttribute('rel', 'stylesheet');\n                l.setAttribute('href', path);\n                l.setAttribute(\"id\", \"loadCss\" + Math.random());\n                document.getElementsByTagName(\"head\")[0].appendChild(l);\n                window[\"_loadCss\"] ? (window[\"_loadCss\"] += \"|\" + path) : (window[\"_loadCss\"] = \"|\" + path);\n            }\n            l && (typeof callback == \"function\") && (l.onload = callback);\n            return true;\n        }\n        //入口方法\n\n    function _modulejs(deps, factory) {\n        //把入口回调作为一个回调模块定义，当有多个入口的时候，都放在数组里面\n        _define(\"_init\", deps, factory);\n    }\n    //递归检查深层依赖环境是否完成，并加载确实的module\n\n    function checkDeps(deps) {\n        //var list = cfg.deps,\n        var list = {},\n            flag = true;\n        //重置依赖分析数组\n        for (var i = 0; i < deps.length; i++) list[deps[i]] = 1;\n        //for (var i in list) list[i] = 1;\n        //构造当前依赖的递归依赖\n        getDesps(deps, list);\n        //依次检查依赖，发现有module遗失则返回flase。进入加载流程\n        for (var i in list) {\n            //检查该依赖模块是否遗失，如果遗失则中断检查去加载\n            if (!cfg.modules[i]) {\n                loadModule(i);\n                flag = false;\n            }\n        }\n        return flag;\n        //获取深层依赖关系队列\n\n        function getDesps(deps, list) {\n            //循环检查新的依赖队列\n            for (var i = 0; i < deps.length; i++) {\n                //如果该module未在全局依赖队列中，则加入到全局队列中\n                if (!list[deps[i]]) {\n                    list[deps[i]] = 1;\n                }\n                //如果该module存在，则递归构造该module的依赖队列。\n                //凡是构造过的module就把状态设置为2，防止循环依赖\n                if (cfg.modules[deps[i]] && list[deps[i]] != 2) {\n                    list[deps[i]] = 2;\n                    getDesps(cfg.modules[deps[i]].dependencies, list);\n                }\n            }\n        }\n    }\n    //解析变量模块名\n\n    function parseVars(id) {\n        var VARS_RE = /{([^{]+)}/g\n        var vars = cfg.vars\n        if (vars && id.indexOf(\"{\") > -1) {\n            id = id.replace(VARS_RE, function(m, key) {\n                return isType(\"String\", vars[key]) ? vars[key] : key\n            })\n        }\n        return id\n    }\n    //配置方法\n\n    function mergeObject(a, b) {\n        for (var i in b) {\n            if (!b.hasOwnProperty(i)) {\n                continue;\n            }\n            if (!a[i]) {\n                a[i] = b[i];\n            } else if (Object.prototype.toString.call(b[i]) == \"[object Object]\") {\n                mergeObject(a[i], b[i]);\n            } else {\n                a[i] = b[i];\n            }\n        }\n        return a;\n    }\n\n    function config(obj) {\n        return cfg = mergeObject(cfg, obj);\n    }\n    //module原型\n\n    function Module(id) {\n        this.id = id;\n        this.dependencies = [];\n        this.exports = null;\n        this.uri = \"\";\n    }\n    //加载模块的对应文件\n\n    function loadModule(id) {\n        var m;\n        if (m = cfg.cacheLoad[id]) {\n            return _define(m.id, m.deps, eval(\"a = \" + m.factory));\n        }\n        //如果module存在则直接返回\n        if (cfg.modules[id]) {\n            emit(\"module_ready\", id);\n            return;\n        }\n        //查找module所对应的文件\n        //todo:这里可以考虑支持把没有alias配置的module按照某些规则生成一条url进行加载。\n        var url = cfg.alias[id] ? cfg.alias[id] : \"\";\n        if (!url) {\n            emit(\"module_loss_alias\", id);\n            return;\n        }\n        //检查是否已经加载该文件，如果文件已经在加载队列，则返回，等待后续代码的执行\n        if (cfg.uris[url]) {\n            return;\n        }\n        //如果当前模块是不是已经发出加载请求，如果已经发出，那么不做加载。\n        if (cfg.loadMod[id]) {\n            return;\n        }\n\n        //开始加载\n        cfg.uris[url] = MODULE_LOADING;\n        cfg.loadMod[id] = 1;\n        var head = document.getElementsByTagName(\"head\")[0] || document.documentElement;\n        var baseElement = head.getElementsByTagName(\"base\")[0];\n        var node = document.createElement(\"script\");\n        node.charset = \"utf-8\";\n        node.async = true;\n        node.src = url;\n        var handler = function() {\n            var callee = arguments.callee\n            cfg.timing[callee.uri] = new Date() - callee.time;\n        };\n        handler.time = new Date();\n        handler.uri = url;\n        node.onload = handler;\n        if (typeof(cfg.beforeLoad) === 'function' && (cfg.beforeLoad(node, cfg, url) === false))\n            return;\n\n        //todo:这里可以考虑监控一下文件加载失败的情况，方便报错和监控等后续的健壮性功能\n        baseElement ? head.insertBefore(node, baseElement) : head.appendChild(node);\n        cfg.debug && emit(\"file_loading\", url);\n\n        loadModuleDep(id);\n    }\n\n    /**\n     * 同步地去加载一些模块\n     * @param  {[type]} id [description]\n     * @return {[type]}    [description]\n     */\n    function loadModuleDep(id) {\n        var dep = cfg.moduleDeps[id],\n            len;\n\n        //额外依赖是一个二维数组\n        //举例\n        // {\n        //   \"lg.guess\": [\n        //     [\"react\"],\n        //     [\"tpl_lot.component\", \"tpl_lg.guess.act\"]  //同一个数组内的模块会被合并载入，实现了动态分组\n        //   ]\n        // }\n        if (dep && (len = dep.length) > 0) {\n            for (var i = len - 1; i >= 0; i--) {\n                var item = dep[i],\n                    len1 = item.length,\n                    moduleToLoad = item[0];\n                if (len1 === 1) {\n                    loadModule(moduleToLoad);\n                } else if (len1 > 1) {\n                    var cmbUrl = cfg.domain + '/c/=',\n                        cmbAr = [];\n                    for (var j = len1 - 1; j >= 0; j--) {\n                        var id1 = item[j];\n                        if (cfg.moduleURI[id1] && !cfg.cacheLoad[id1] && !cfg.modules[id1]) {\n                            cmbUrl += cfg.moduleURI[id1].replace(cfg.domain, '') + (j > 0 ? ',' : '');\n                            cmbAr.push(id1);\n                        }\n                    }\n                    var len1 = cmbAr.length;\n                    if (len1 > 0) {\n                        for (var j = len1 - 1; j >= 0; j--) {\n                            //污染 alias 变量\n                            cfg.alias[cmbAr[j]] = cmbUrl;\n                        }\n                        loadModule(cmbAr[0]);\n                    }\n                }\n            };\n        }\n    }\n\n    //事件监听\n\n    function on(name, cb) {\n        var cbs = cfg.events[name];\n        if (!cbs) {\n            cbs = cfg.events[name] = [];\n        }\n        cbs.push(cb);\n    }\n\n    //事件广播\n\n    function emit(name, evt) {\n        debug(name, evt);\n\n        if (!cfg.events[name] || cfg.events[name].length == 0) {\n            return;\n        }\n        //for (var i in cfg.events[name]) {\n        for (var i = 0, l = cfg.events[name].length; i < l; i++) {\n            cfg.events[name][i](evt);\n        }\n        if (name === 'error') {\n            delete cfg.events[name];\n        }\n    }\n    //清理数组中的空元素\n\n    function cleanArray(a) {\n        var n = [];\n        for (var i = 0; i < a.length; i++) {\n            a[i] && n.push(a[i]);\n        }\n        return n;\n    }\n    //去重合并数组\n\n    function mergeArray(a, b) {\n        for (var i = 0; i < b.length; i++) {\n            ((\",\" + a + \",\").indexOf(\",\" + b[i] + \",\") < 0) && a.push(b[i]);\n        }\n        return a;\n    }\n    //对象类型判断\n\n    function isType(type, obj) {\n        return Object.prototype.toString.call(obj) === \"[object \" + type + \"]\"\n    }\n    //分析module的依赖关系\n\n    function parseDependencies(code) {\n\n        var commentRegExp = /(\\/\\*([\\s\\S]*?)\\*\\/|([^:|^\"|^']|^)\\/\\/(.*)$)/mg;\n        var cjsRequireRegExp = /[^.]\\s*require\\s*\\(\\s*[\"']([^'\"\\s]+)[\"']\\s*\\)/g;\n        var ret = [];\n        code.replace(commentRegExp, \"\").replace(cjsRequireRegExp, function(match, dep) {\n            dep && ret.push(parseVars(dep));\n        })\n        return ret;\n    }\n\n    function debug() {\n        if (!cfg.debug) {\n            return true;\n        }\n        var a = [],\n            l = arguments.length;\n        for (var i = 0; i < l; i++) {\n            a.push(arguments[i]);\n        }\n        try {\n            // console.log.apply(console, a);\n        } catch (e) {}\n    }\n}(this));\n"],"sourceRoot":"/source/"}