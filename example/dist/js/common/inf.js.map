{"version":3,"sources":["common/inf.js"],"names":["define","require","exports","module","g","__Msgs","time","window","on","type","fn","dom","id","Object","prototype","toString","call","push","guid","Date","emit","center","args","queue","reValue","o","debug","i","j","length","apply","this","concat","backData","msgBack","msgGoon","sendMsg","postMsg","t","Array","slice","arguments","off","_o","splice","offReg","reg","RegExp","test"],"mappings":"AAGAA,OAAO,MAAO,SAASC,EAASC,EAASC,GACrC,GACIC,IACAC,UACAC,KAAM,EAEVC,QAAmB,WAAIH,EASvBF,EAAQM,GAAK,SAASC,EAAMC,EAAIC,EAAKC,GAC7B,GAAIP,GAASD,EAAEC,MACfA,GAAOI,GAAwD,kBAAhDI,OAAOC,UAAUC,SAASC,KAAKX,EAAOI,IAA6BJ,EAAOI,MACzFJ,EAAOI,GAAMQ,MACTC,KAAMN,EAAKA,GAAM,GAAIO,MAAS,GAAKf,EAAEE,OACrCI,GAAIA,EACJC,IAAKA,KAejBT,EAAQkB,KAAO,SAASX,GACpB,MAAO,UAASY,EAAQC,EAAMC,EAAOC,EAASN,EAAMO,GAEhD,GAAIC,GAAQL,EAAO,IACnB,IAAIK,EACA,IAAK,GAAIC,GAAI,EAAGC,EAAIF,EAAMG,OAAQF,EAAIC,EAAGD,IACrCD,EAAMC,GAAGjB,GAAGoB,MAAMC,MAAOtB,GAAMuB,OAAOV,GAI9C,IAAIC,EAAQF,EAAOZ,GAAO,CAMtB,IAAK,GALDwB,IACAC,QAAS,KACTC,SAAS,EACTC,QAAS,IAEJT,EAAI,EAAGC,EAAIL,EAAMM,OAAQF,EAAIC,IAClCH,EAAIF,EAAMI,GACVH,EAAUC,EAAEf,GAAGoB,MAAML,EAAEd,IAAKW,GACmB,mBAA3CT,OAAOC,UAAUC,SAASC,KAAKQ,IAAoD,mBAAb,IACtES,EAASC,QAAUV,EAAQU,QAC3BD,EAASE,QAAUX,EAAQW,WAAY,EACvCF,EAASG,QAAUZ,EAAQY,UAE3BH,EAASC,QAAUV,EACnBS,EAASE,SAAU,EACnBF,EAASG,QAAU,IAGnBH,EAASG,SACTlC,EAAQmC,QAAQP,MAAMC,MAAOE,EAASG,SAASJ,OAAOV,IAEtDW,EAASE,WAAY,GAhBYR,KAoBzC,GAAIL,EAAKO,QAAU,EAAG,CAClB,GAAIS,GAAIhB,EAAK,EAED,qBAARb,GACAP,EAAQkB,KAAK,sBAAwBkB,EAAG7B,GAGhD,MAAOwB,GAASC,UAEtB9B,EAAEC,OAAQkC,MAAMzB,UAAU0B,MAAMxB,KAAKyB,UAAW,KAYtDvC,EAAQwC,IAAM,SAASjC,EAAMG,GACzB,GAAIP,GAASD,EAAEC,MACf,IAAKO,EAEE,CACH,GAAI+B,GAAKtC,EAAOI,MAChB,KAAK,GAAIkB,KAAKgB,GACV,GAAIA,EAAGhB,GAAGT,MAAQN,EAAI,CAClB+B,EAAGC,OAAOjB,IAAK,EACf,mBANDtB,GAAOI,EAUlB,OAAOsB,OASX7B,EAAQ2C,OAAS,SAASpC,GACtB,GAAIJ,GAASD,EAAEC,OACXyC,EAAM,GAAIC,QAAOtC,EACrB,KAAK,GAAIkB,KAAKtB,GACNyC,EAAIE,KAAKrB,UACFtB,GAAOsB,EAGtB,OAAOI","file":"common/inf.js","sourcesContent":["/**\n * 消息管理模块\n */\ndefine('inf', function(require, exports, module) {\n    var _cacheThisModule_;\n    var g = {\n        __Msgs: {},\n        time: 0\n    };\n    window[\"_infConfig\"] = g;\n    /**\n     * 监听消息\n     * @param  {[string]}   type 自定义的消息名称，必须\n     * @param  {Function} fn   处理函数  必须\n     * @param  {[domelement]}   dom  用于透传的dom ，非必须\n     * @param  {[string]}   id   函数唯一标识，非必须\n     * @return {[null]}        无返回\n     */\n    exports.on = function(type, fn, dom, id) {\n            var __Msgs = g.__Msgs;\n            __Msgs[type] = Object.prototype.toString.call(__Msgs[type]) == \"[object Array]\" ? __Msgs[type] : [];\n            __Msgs[type].push({\n                guid: id ? id : +new Date() + \"\" + g.time++,\n                fn: fn,\n                dom: dom\n            })\n        }\n        /**\n         * 消息广播\n         * @param  {[string]} type 自定义的消息名称，必须\n         *                         除type外的其他参数会透传给处理函数\n         * @return {[object]}      必须符合规范\n         *                         {\n         *                         \t\tmsgBack: mixed,//任意类型，作为postMsg的返回值\n         *                         \t\tmsgGoon :boolen,//true:执行后续事件处理函数，false:不执行\n         *                         \t\tsendMsg:string//新的广播消息的名称，空串则不广播\n         *                            }\n         *                         如果没有按照规范返回，则此值直接作为postMsg的返回值，且后续事件处理函数不会执行\n         */\n    exports.emit = function(type) {\n        return function(center, args, queue, reValue, guid, o) {\n            //纯粹调试用\n            var debug = center[\"*\"];\n            if (debug) { //所有消息都执行\n                for (var i = 0, j = debug.length; i < j; i++) {\n                    debug[i].fn.apply(this, [type].concat(args));\n                }\n            }\n\n            if (queue = center[type]) {\n                var backData = {\n                    msgBack: null, //函数返回值\n                    msgGoon: true, //是否处理后续函数\n                    sendMsg: \"\" //新的广播消息名称\n                };\n                for (var i = 0, j = queue.length; i < j; i++) {\n                    o = queue[i];\n                    reValue = o.fn.apply(o.dom, args);\n                    if (Object.prototype.toString.call(reValue) == \"[object Object]\" && typeof(reValue) != \"undefined\") { //object类型\n                        backData.msgBack = reValue.msgBack;\n                        backData.msgGoon = reValue.msgGoon === false ? false : true;\n                        backData.sendMsg = reValue.sendMsg;\n                    } else {\n                        backData.msgBack = reValue;\n                        backData.msgGoon = true;\n                        backData.sendMsg = \"\";\n                    }\n\n                    if (backData.sendMsg) { //需要广播新消息\n                        exports.postMsg.apply(this, [backData.sendMsg].concat(args));\n                    }\n                    if (backData.msgGoon === false) { //阻止后续事件处理\n                        break;\n                    }\n                }\n                if (args.length >= 2) {\n                    var t = args[1],\n                        clickId = \"\";\n                    if (type != \"inf.report.click\") {\n                        exports.emit(\"inf.report.click\", {}, t, type);\n                    }\n                }\n                return backData.msgBack;\n            }\n        }(g.__Msgs, Array.prototype.slice.call(arguments, 1))\n    }\n\n\n    /**\n     * 从队列中移除消息\n     * @param  {[string]} type 自定义的消息名称，必须\n     * @param  {[string]} id  函数唯一标识，非必须。\n     *                         如果没有id，则删除type下所有处理函数\n     *                         如果有id,则删除指定处理函数\n     * @return {[object]}      调用者\n     */\n    exports.off = function(type, id) {\n        var __Msgs = g.__Msgs;\n        if (!id) { //没有id,则删除事件名称下所有处理函数\n            delete __Msgs[type];\n        } else {\n            var _o = __Msgs[type] || [];\n            for (var i in _o) {\n                if (_o[i].guid == id) {\n                    _o.splice(i--, 1);\n                    break;\n                }\n            }\n        }\n        return this;\n    }\n\n\n    /**\n     * 从队列中移除消息,非建议方法，不利于后续自动化扫描\n     * @param  {[string]} type 自定义的事件名称，正则表达式\n     * @return {[object]}      调用者\n     */\n    exports.offReg = function(type) {\n        var __Msgs = g.__Msgs,\n            reg = new RegExp(type);\n        for (var i in __Msgs) {\n            if (reg.test(i)) {\n                delete __Msgs[i];\n            }\n        }\n        return this;\n    }\n});\n"],"sourceRoot":"/source/"}